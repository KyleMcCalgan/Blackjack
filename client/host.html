<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Configuration - Blackjack</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        body {
            background: #1a1a1a;
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #999;
            margin-bottom: 30px;
        }

        .status {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status.connected {
            border: 2px solid #4CAF50;
        }

        .status.disconnected {
            border: 2px solid #f44336;
        }

        .config-section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .config-section h2 {
            color: #4CAF50;
            margin-top: 0;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #e0e0e0;
            font-weight: 500;
        }

        .label-description {
            font-size: 0.85rem;
            color: #999;
            font-weight: normal;
        }

        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 6px;
            color: #e0e0e0;
            font-size: 1rem;
            box-sizing: border-box;
        }

        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #444;
            transition: 0.3s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4CAF50;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .debug-panel {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .debug-panel h3 {
            margin-top: 0;
            color: #FFC107;
        }

        .debug-output {
            color: #4CAF50;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>ðŸŽ° Blackjack Host Setup</h1>
    <p class="subtitle">Configure your game settings</p>

    <div id="connectionStatus" class="status disconnected">
        <strong>Status:</strong> <span id="statusText">Connecting...</span>
    </div>

    <div class="config-section">
        <h2>Bankroll & Betting</h2>

        <div class="form-group">
            <label>
                Starting Bankroll
                <span class="label-description">Each player starts with this amount</span>
            </label>
            <input type="number" id="startingBankroll" value="1000" min="100" step="100">
        </div>

        <div class="form-group">
            <label>
                Minimum Bet
                <span class="label-description">Smallest allowed bet per hand</span>
            </label>
            <input type="number" id="minBet" value="10" min="1" step="5">
        </div>

        <div class="form-group">
            <label>
                Maximum Bet
                <span class="label-description">Largest allowed bet per hand (leave blank for no limit)</span>
            </label>
            <input type="number" id="maxBet" value="500" min="10" step="50" placeholder="No limit">
        </div>
    </div>

    <div class="config-section">
        <h2>Game Rules</h2>

        <div class="form-group">
            <label>
                Number of Decks
                <span class="label-description">Standard is 6 decks (312 cards)</span>
            </label>
            <select id="deckCount">
                <option value="1">1 Deck (52 cards)</option>
                <option value="2">2 Decks (104 cards)</option>
                <option value="4">4 Decks (208 cards)</option>
                <option value="6" selected>6 Decks (312 cards)</option>
                <option value="8">8 Decks (416 cards)</option>
            </select>
        </div>

        <div class="form-group">
            <label>
                Blackjack Payout
                <span class="label-description">How much blackjack pays (3:2 is standard)</span>
            </label>
            <select id="blackjackPayout">
                <option value="3:2" selected>3:2 (Standard)</option>
                <option value="6:5">6:5 (House favorable)</option>
                <option value="2:1">2:1 (Player favorable)</option>
            </select>
        </div>

        <div class="form-group">
            <label>
                Insurance Payout
                <span class="label-description">Payout when dealer has blackjack</span>
            </label>
            <select id="insurancePayout">
                <option value="2:1" selected>2:1 (Standard)</option>
                <option value="3:2">3:2 (House favorable)</option>
            </select>
        </div>

        <div class="form-group">
            <div class="toggle-group">
                <label style="margin-bottom: 0;">
                    Split Aces = Blackjack
                    <span class="label-description">A+10 after split counts as blackjack</span>
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="splitAcesBlackjack" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <button class="btn" id="saveConfigBtn" disabled>
        Waiting for connection...
    </button>

    <div class="debug-panel">
        <h3>Server Communication (Debug)</h3>
        <div id="debugOutput" class="debug-output">Waiting for connection...</div>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script>
        const socket = io();
        let connected = false;

        // DOM elements
        const statusDiv = document.getElementById('connectionStatus');
        const statusText = document.getElementById('statusText');
        const saveBtn = document.getElementById('saveConfigBtn');
        const debugOutput = document.getElementById('debugOutput');

        // Form inputs
        const inputs = {
            startingBankroll: document.getElementById('startingBankroll'),
            minBet: document.getElementById('minBet'),
            maxBet: document.getElementById('maxBet'),
            deckCount: document.getElementById('deckCount'),
            blackjackPayout: document.getElementById('blackjackPayout'),
            insurancePayout: document.getElementById('insurancePayout'),
            splitAcesBlackjack: document.getElementById('splitAcesBlackjack')
        };

        // Connection handlers
        socket.on('connect', () => {
            connected = true;
            statusDiv.className = 'status connected';
            statusText.textContent = 'Connected';
            saveBtn.disabled = false;
            saveBtn.textContent = 'Save Configuration';
            addDebugMessage('Connected to server: ' + socket.id);
        });

        socket.on('disconnect', () => {
            connected = false;
            statusDiv.className = 'status disconnected';
            statusText.textContent = 'Disconnected';
            saveBtn.disabled = true;
            saveBtn.textContent = 'Waiting for connection...';
            addDebugMessage('Disconnected from server');
        });

        // Listen for config confirmation from server
        socket.on('config-saved', (data) => {
            addDebugMessage('Server confirmed config save:\n' + JSON.stringify(data, null, 2));
            saveBtn.textContent = 'âœ“ Configuration Saved!';
            setTimeout(() => {
                saveBtn.textContent = 'Save Configuration';
            }, 2000);
        });

        // Get current configuration
        function getConfig() {
            const maxBetValue = inputs.maxBet.value.trim();
            return {
                startingBankroll: parseInt(inputs.startingBankroll.value),
                minBet: parseInt(inputs.minBet.value),
                maxBet: maxBetValue === '' ? null : parseInt(maxBetValue),
                deckCount: parseInt(inputs.deckCount.value),
                blackjackPayout: inputs.blackjackPayout.value,
                insurancePayout: inputs.insurancePayout.value,
                splitAcesBlackjack: inputs.splitAcesBlackjack.checked
            };
        }

        // Save button handler
        saveBtn.addEventListener('click', () => {
            const config = getConfig();

            // Validate
            if (config.maxBet !== null && config.minBet >= config.maxBet) {
                alert('Minimum bet must be less than maximum bet!');
                return;
            }

            if (config.startingBankroll < config.minBet) {
                alert('Starting bankroll must be at least the minimum bet!');
                return;
            }

            addDebugMessage('Sending config to server:\n' + JSON.stringify(config, null, 2));
            socket.emit('save-config', config);
        });

        // Real-time updates (send to server on any change)
        Object.values(inputs).forEach(input => {
            input.addEventListener('change', () => {
                if (connected) {
                    const config = getConfig();
                    addDebugMessage('Config changed (auto-update):\n' + JSON.stringify(config, null, 2));
                    socket.emit('config-update', config);
                }
            });
        });

        // Debug output helper
        function addDebugMessage(message) {
            const timestamp = new Date().toLocaleTimeString();
            const newMessage = `[${timestamp}] ${message}\n\n`;
            debugOutput.textContent = newMessage + debugOutput.textContent;

            // Limit debug output length
            const lines = debugOutput.textContent.split('\n');
            if (lines.length > 50) {
                debugOutput.textContent = lines.slice(0, 50).join('\n');
            }
        }
    </script>
</body>
</html>
